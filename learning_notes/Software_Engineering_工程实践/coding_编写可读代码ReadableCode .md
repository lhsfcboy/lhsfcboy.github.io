# The Art of Readable Code

[《The Art of Readable Code》Pegasus Wang](https://zhuanlan.zhihu.com/p/28334375)

## 1. 代码应当易于理解

代码的写法应当使别人理解它所需的时间最小化。（相比于仅仅减少行数来说）如果与其他理念冲突，本条优先。

## 2. 把信息装进名字里

- 选择专业的词语（清晰和精确）。比如 `fetchPage` 优于 `getPage`。
- 避免宽泛的名字：避免 `tmp` 和 `retval` 这样宽泛的名字。好的名字应当描述变量的目的或者它承载的值，`tmp_file` 也比 `tmp` 好。
- 用具体的名字代替抽象的名字。
- 使用前缀或者后缀给名字附带更多信息（英语表示法，非匈牙利命名法）。比如 `delay_secs`，`html_utf8`。
- 决定名字的长度：小的作用域尽可能用短名称，否则应该包含足够的信息。缩略词要考虑团队新成员能否理解其含义。
- 利用名字的格式表达含义：比如纯大写表示常量，骆驼命名法表示类等，遵循一门语言的编程命名约定。在项目中保持一致的命名法。

## 3. 不会误解的名字

- 不要使用有歧义的名称。
- 用 `max` 和 `min` 前缀表示上限和下限；对于包含的范围用 `first` 和 `last`；对于包含/排除范围（左闭右开区间）用 `begin` 和 `end`。
- 使用 `is`、`has`、`can` 或 `should` 这样的词来使 `bool` 值更明确，并且尽量避免用反义词汇。比如 `use_ssl` 好于 `disable_ssl`。
- 与使用者的期望匹配：避免让使用者误解。比如使用 `get` 可能让使用者以为这是轻量级操作，可以用 `compute` 替代。

## 4. 审美

好的代码应当具备美观性，遵循三条原则：

1. 使用一致的布局，让读者能够快速习惯这种风格。
2. 让相似的代码看上去相似。
3. 把相关的代码分组，形成代码块。

为了使代码更易于浏览：

- 重新安排换行来保持一致和紧凑。
- 提炼出『方法』整理不规则的东西。
- 使用『列对齐』以提高可读性。
- 选择一个有意义的顺序，比如字典序、重要性等排序。
- 把声明按照逻辑分组，并组织成代码段落。

一致的风格比正确的风格重要。

## 5. 该写什么样的注释

好代码 > 差代码 + 好注释。

- 什么时候加注释：当代码不易理解或有使用注意事项时。
- 不需要的注释：避免用注释粉饰可读性差的代码。

注释内容建议：

- 用代码记录你的思想，加入『指导性批注』。
- 为瑕疵写注释（`TODO`，`FIXME`，`HACK`）。
- 为常量加注释。
- 从读者角度思考注释内容，解释代码中容易让人疑惑的部分。
- 提醒可能的陷阱，比如数据规模增加后性能问题等。
- 提供全局观注释，说明类之间的交互、数据流动、入口点等。
- 写总结性注释，帮助读者快速理解代码块而不迷失在细节中。

## 6. 写出言简意赅的注释

注释应当具有高信息密度：

- 保持注释紧凑。
- 避免使用不明确的代词，直接使用代码名称代替。
- 润色粗糙的句子。
- 精确描述函数的行为。
- 用输入输出例子描述特殊情况。
- 声明代码的意图，很多时候注释就是告诉读者你写代码时的思路。
- 使用具名函数，语言允许时通过具名参数调用函数，如 `f(timeout=1)`。
- 采用信息量高的词语，使用业界常用词汇。

## 7. 把控制流变得易读

- 条件语句中参数顺序：左侧为变化值，右侧为常量。
- `if/else` 语句块顺序：先处理正常逻辑、简单情况、可疑情况。
- 避免在三目运算符中使用复杂表达式，优先考虑 `if/else` 更加直观。
- 避免使用 `do/while`。
- 提前返回函数结果。
- 最小化嵌套，避免过多逻辑嵌套增加理解难度。
- 通过提前返回减少嵌套。
- 理解程序执行流程：避免滥用线程、信号量、异常等让流程难以理解的结构。

## 8. 拆分超长表达式

大多数人最多能同时考虑 3-4 件事情，超长表达式难以理解：

- 引入解释变量，例如：
    ```python
    username = line.split(':')[0].strip()
    if username == "root":
        ...
    ```
- 总结变量，使用显式布尔表达式，例如：
    ```python
    user_owns_document = (request.user.id == document.owner_id)
    ```
- 使用德摩根律简化逻辑表达式：
    ```python
    not (a or b or c) <=> (not a) and (not b) and (not c)
    ```

- 不要滥用短路逻辑，避免影响可读性。
- 从逻辑反面简化表达式。
- 提炼重复表达式为变量。

## 9. 变量与可读性

变量的草率运用会增加理解难度：

- 变量越多，越难跟踪。
- 变量作用域越大，越难跟踪其变化。
- 变量变化频繁，难以确定其当前值。

提升可读性的方法：

- 减少不必要的临时变量。
- 减少中间结果。
- 减少控制流变量。
- 缩小变量作用域，避免名称污染。
- 把变量定义放在使用前。
- 尽量让变量只被写一次。

## 10. 抽取不相关子问题

将不相关的子问题抽取出来，便于聚焦于程序的更高层目标：

- 不相关子问题是自包含的，与其他部分无关。
- 提取纯工具代码。
- 简化已有接口。
- 不要过犹不及，太多小函数会增加理解负担。

## 11. 一次只做一件事

使代码一次只做一件事的流程：

1. 列出代码所有的『任务』。
2. 尽力将这些任务拆分到不同的函数或代码段中。

对于复杂的代码，尝试列出任务，拆分为单独的函数、类，或在函数中划分『逻辑段落』。

## 12. 把想法变成代码

一个清晰的过程使代码更易理解：

1. 用自然语言描述代码要做什么。
2. 注意描述中的关键词和短语。
3. 写出与描述相符的代码。

## 13. 少写代码

- 你可能不需要提前实现功能，避免不必要的代码。
- 质疑和拆分需求，简化问题。
- 保持代码库简洁，减少重复代码。
- 删除无用的代码。
- 分离项目为多个子项目。
- 避免代码『重量』，不情愿删除代码往往是因为它代表工作量。
- 熟悉已有库，防止重复造轮子。

## 14. 测试与可读性

测试应具有可读性，方便其他程序员修改和增加测试：

- 使用辅助函数隐藏不重要的细节。
- 让错误信息易于理解。
- 使用简单但覆盖边界条件的测试值。
- TDD 思维模式有助于写出更好的代码。
- 最解耦的代码往往最容易测试。

避免以下问题：

- 为测试牺牲真实代码的可读性。
- 过度追求 100% 测试覆盖率。
- 测试成为开发的阻碍。

好的代码与测试的特征：

- 类中少有或无内部状态，测试时无需检查隐藏状态。
- 每次只做一件事，测试覆盖更简洁。
- 依赖少，可以独立测试。
- 接口简单明确，便于行为测试和重用。
