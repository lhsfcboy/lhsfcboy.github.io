# `top`命令详解

以下是`top`命令的输出示例及其解析：

```bash
top - 01:06:48 up  1:22,  1 user,  load average: 0.06, 0.60, 0.48
Tasks:  29 total,   1 running,  28 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.3% us,  1.0% sy,  0.0% ni, 98.7% id,  0.0% wa,  0.0% hi,  0.0% si
Mstrong:    191272k total,   173656k used,    17616k free,    22052k buffers
Swap:   192772k total,        0k used,   192772k free,   123988k cached
```

## 统计信息区

前五行显示系统的整体统计信息。

### 第一行：任务队列信息（类似 `uptime` 命令）

- **当前时间**：`01:06:48`
- **系统运行时间**：`up 1:22`（时:分格式）
- **当前登录用户数**：`1 user`
- **系统负载**：`load average: 0.06, 0.60, 0.48`（任务队列的平均长度，分别为1分钟、5分钟、15分钟的平均值）

### 第二、三行：进程和CPU信息

- **Tasks**：29 total（进程总数）
- **1 running**：正在运行的进程数
- **28 sleeping**：睡眠中的进程数
- **0 stopped**：停止的进程数
- **0 zombie**：僵尸进程数

- **Cpu(s)**：
  - `0.3% us`：用户空间占用CPU的百分比
  - `1.0% sy`：内核空间占用CPU的百分比
  - `0.0% ni`：用户进程空间内改变过优先级的进程占用CPU的百分比
  - `98.7% id`：空闲CPU百分比
  - `0.0% wa`：等待输入输出的CPU时间百分比
  - `0.0% hi` 和 `0.0% si` 分别为硬件和软件中断占用的CPU百分比

### 第四、五行：内存信息

- **Mstrong**：
  - `191272k total`：物理内存总量
  - `173656k used`：已使用的物理内存
  - `17616k free`：空闲的物理内存
  - `22052k buffers`：用于内核缓存的内存量

- **Swap**：
  - `192772k total`：交换区总量
  - `0k used`：已使用的交换区
  - `192772k free`：空闲交换区
  - `123988k cached`：缓冲的交换区大小（内存中存在的交换区数据）

## 进程信息区

统计信息区下方为各进程的详细信息。各列的含义如下：

| 序号 | 列名      | 含义                                         |
| ---- | --------- | -------------------------------------------- |
| a    | PID       | 进程ID                                       |
| b    | PPID      | 父进程ID                                     |
| c    | RUSER     | Real用户名称                                 |
| d    | UID       | 进程所有者的用户ID                           |
| e    | USER      | 进程所有者的用户名                           |
| f    | GROUP     | 进程所有者的组名                             |
| g    | TTY       | 启动进程的终端名（若不是从终端启动则为`?`）  |
| h    | PR        | 优先级                                       |
| i    | NI        | nice值（负值为高优先级，正值为低优先级）     |
| j    | P         | 最后使用的CPU（在多CPU环境下有意义）         |
| k    | %CPU      | 上次更新到现在的CPU时间占用百分比            |
| l    | TIME      | 进程使用的CPU时间总计，单位为秒              |
| m    | TIME+     | 进程使用的CPU时间总计，单位为1/100秒         |
| n    | %MEM      | 进程使用的物理内存百分比                     |
| o    | VIRT      | 虚拟内存总量（单位kb），`VIRT=SWAP+RES`       |
| p    | SWAP      | 使用的虚拟内存中被换出的大小（单位kb）       |
| q    | RES       | 未被换出的物理内存大小（单位kb），`RES=CODE+DATA` |
| r    | CODE      | 可执行代码占用的物理内存大小（单位kb）       |
| s    | DATA      | 数据段+栈占用的物理内存大小（单位kb）        |
| t    | SHR       | 共享内存大小（单位kb）                       |
| u    | nFLT      | 页面错误次数                                 |
| v    | nDRT      | 修改过的页面数（最后一次写入后的页面数）     |
| w    | S         | 进程状态（D=不可中断睡眠、R=运行、S=睡眠、T=跟踪/停止、Z=僵尸） |
| x    | COMMAND   | 命令名称/命令行                              |
| y    | WCHAN     | 若进程在睡眠，显示睡眠中的系统函数名         |
| z    | Flags     | 任务标志，参考`sched.h`                      |

## 更改显示内容

- **按 `f` 键**：选择显示的内容。显示列的列表后，按`a-z`切换显示/隐藏，回车确定。
- **按 `o` 键**：改变列的显示顺序。小写`a-z`将相应列右移，大写`A-Z`将列左移，回车确定。
- **按 `F` 或 `O` 键**：按`a-z`将进程按照相应列排序，按大写`R`键可倒转当前排序。

## 有用的命令

| 命令                     | 作用                        |
| ------------------------ | --------------------------- |
| `top-z-x-<`              | 选择排序列                  |
| `top-1`                  | 单独显示各CPU的运行状态     |
| `z`                      | 打开/关闭彩色显示           |
| `x`                      | 高亮显示排序列              |
